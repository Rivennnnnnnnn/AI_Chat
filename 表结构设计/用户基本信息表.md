# 用户基本信息表

## 基本登录信息表(user_base)

CREATE TABLE `user_base` (
`id` BIGINT UNSIGNED PRIMARY KEY COMMENT '雪花算法生成的唯一ID',
`username` VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
`password` VARCHAR(255) NOT NULL COMMENT '哈希加密后的密码',
`email` VARCHAR(100) UNIQUE COMMENT '邮箱',
`created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
`updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--会话表 (UUID 版本)
CREATE TABLE `conversations` (
    `id` VARCHAR(45) NOT NULL COMMENT 'UUID',
    `user_id` BIGINT NOT NULL COMMENT '所属用户ID', -- 假设用户表依然用 BIGINT
    `persona_id` VARCHAR(45) DEFAULT NULL COMMENT '人格ID',
    `title` VARCHAR(255) DEFAULT NULL COMMENT '会话标题',
    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
    `is_deleted` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否逻辑删除',
    PRIMARY KEY (`id`),
    INDEX `idx_user_id` (`user_id`),
    INDEX `idx_persona_id` (`persona_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 消息表 (UUID 版本)
CREATE TABLE `messages` (
    `id` VARCHAR(45) NOT NULL COMMENT 'UUID',
    `conversation_id` VARCHAR(45) NOT NULL COMMENT '所属会话ID',
    `order_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '消息在会话中的顺序',
    `role` VARCHAR(20) NOT NULL COMMENT '角色: user, assistant, system',
    `content` TEXT NOT NULL COMMENT '消息文本内容',
    `model` VARCHAR(50) DEFAULT NULL COMMENT '使用的AI模型名称',
    `token_count` INT DEFAULT 0 COMMENT 'Token消耗统计',
    `created_at` DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) COMMENT '消息发送时间(精确到微秒)',
    PRIMARY KEY (`id`),
    UNIQUE INDEX `idx_order_id` (`order_id`), -- 确保 order_id 唯一自增
    INDEX `idx_conversation_order` (`conversation_id`, `order_id`), -- 复合索引，优化按会话和顺序查询
    INDEX `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;